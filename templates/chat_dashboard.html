{% extends "base.html" %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
{% endblock %}

{% block content %}
<div class="chat-dashboard">
    <aside class="chat-sidebar">
        <div class="sidebar-header">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" placeholder="Search users or messages">
            </div>
            <div class="search-results" style="display: none;">
                <div class="search-results-header">
                    <h3>Search Results</h3>
                    <button class="close-search">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="search-results-list"></div>
            </div>
            <div class="chat-filters">
                <button class="filter-btn active">All</button>
                <button class="filter-btn">Unread</button>
                <button class="filter-btn">Groups</button>
            </div>
        </div>
        
        <div class="chats-container">
            {% for chat in chats %}
            <div class="chat-item {% if chat.active %}active{% endif %}" 
                 data-chat-id="{{ chat.id.split('_')[1] }}"
                 data-chat-type="{{ chat.type }}">
                <div class="chat-avatar">
                    {% if chat.avatar %}
                        <img src="{{ chat.avatar }}" alt="{{ chat.name }}">
                    {% else %}
                        <div class="avatar-placeholder">{{ chat.name[0] }}</div>
                    {% endif %}
                    {% if chat.online %}
                        <span class="online-badge"></span>
                    {% endif %}
                </div>
                <div class="chat-content">
                    <div class="chat-title">{{ chat.name }}</div>
                    <div class="chat-message">{{ chat.last_message }}</div>
                </div>
                <div class="chat-meta">
                    <div class="chat-time">{{ chat.time }}</div>
                    {% if chat.unread %}
                        <span class="chat-badge">{{ chat.unread }}</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </aside>

    <main class="chat-area">
        {% if current_chat.id %}
            <div class="chat-header">
                <div class="chat-header-info">
                    <div class="chat-avatar">
                        {% if current_chat.avatar %}
                            <img src="{{ current_chat.avatar }}" alt="{{ current_chat.name }}">
                        {% else %}
                            <div class="avatar-placeholder">{{ current_chat.name[0] }}</div>
                        {% endif %}
                        {% if current_chat.online %}
                            <span class="online-badge"></span>
                        {% endif %}
                    </div>
                    <div>
                        <div class="chat-header-title">{{ current_chat.name }}</div>
                        <div class="chat-header-subtitle">
                            {% if current_chat.online %}Online{% else %}Offline{% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="messages-container">
                {% for message in messages %}
                <div class="message {% if message.sent %}sent{% else %}received{% endif %}">
                    {% if not message.sent %}
                    <div class="message-avatar">
                        {% if message.avatar %}
                            <img src="{{ message.avatar }}" alt="{{ message.sender }}">
                        {% else %}
                            <div class="avatar-placeholder">{{ message.sender[0] }}</div>
                        {% endif %}
                    </div>
                    {% endif %}
                    <div class="message-content">
                        <div class="message-bubble">{{ message.content }}</div>
                        <div class="message-time">{{ message.time }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="chat-input">
                <form method="POST" class="message-form" id="messageForm">
                    <div class="input-container">
                        <button type="button" class="input-action-btn">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <textarea class="message-input" placeholder="Type a message..." rows="1"></textarea>
                        <button type="submit" class="input-action-btn send-btn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </form>
            </div>
        {% else %}
            <div class="empty-chat">
                <div class="empty-chat-content">
                    <i class="fas fa-comments"></i>
                    <h2>Welcome to Chatika TANAPA</h2>
                    <p>Select a chat to start messaging</p>
                </div>
            </div>
        {% endif %}
    </main>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %} 